<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"> <!--<![endif]-->
    <head>
        <meta charset="UTF-8">

        <title>cast</title>

        <meta name="viewport" content="width=device-width,initial-scale=1">

<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<!-- <link rel="stylesheet" href="/static/css/root.css"> -->

<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<!-- <script src="//platform.twitter.com/widgets.js"></script> -->

<!-- <script src="/static/js/root.js"></script> -->


        <!--[if lt IE 9]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <script>
            document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/,'js');
        </script>
    </head>
    <body>
<header>
  <nav class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#boostjp-navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">boostjp : Boost日本語情報サイト</a>
      </div>

      <div class="collapse navbar-collapse" id="boostjp-navbar-collapse">
        <form class="navbar-form navbar-right" role="search">
          <div class="form-group">
            <input type="text" class="form-control" placeholder="Search">
          </div>
          <button type="submit" class="btn btn-default">検索</button>
        </form>
      </div>
    </div>
  </nav>
</header>

        <main id="main" role="main">
            <div class="container-fluid">
<div class="row">
  <div class="col-md-2">
<ul><li><a href="/study_meeting.html">study_meeting</a></li><li><a href="/communities.html">communities</a></li><li><a href="/archive.html">archive</a></li><li><a href="/document.html">document</a></li><li><a href="/boostcon.html">boostcon</a></li><li><a href="/tips.html">tips</a></li><li><a href="/the-team.html">the-team</a></li><li><a href="/cppnow.html">cppnow</a></li><li><a href="/mailing-lists.html">mailing-lists</a></li><li><a href="/howtobuild.html">howtobuild</a></li><li><a href="/used_project.html">used_project</a></li><li><a href="/index.html">index</a></li><li><a href="/tips/noncopyable.html">noncopyable</a></li><li><a href="/tips/move.html">move</a></li><li><a href="/tips/math.html">math</a></li><li><a href="/tips/initialize.html">initialize</a></li><li><a href="/tips/string_algo.html">string_algo</a></li><li><a href="/tips/signals.html">signals</a></li><li><a href="/tips/mpi.html">mpi</a></li><li><a href="/tips/lockfree-queue.html">lockfree-queue</a></li><li><a href="/tips/logging.html">logging</a></li><li><a href="/tips/version.html">version</a></li><li><a href="/tips/format.html">format</a></li><li><a href="/tips/multi_index.html">multi_index</a></li><li><a href="/tips/ini.html">ini</a></li><li><a href="/tips/filesystem.html">filesystem</a></li><li><a href="/tips/partial_eval.html">partial_eval</a></li><li><a href="/tips/dynamic_assert.html">dynamic_assert</a></li><li><a href="/tips/multiprec-int.html">multiprec-int</a></li><li><a href="/tips/finite_state_machine.html">finite_state_machine</a></li><li><a href="/tips/geometry.html">geometry</a></li><li><a href="/tips/tuple.html">tuple</a></li><li><a href="/tips/dynamic_type.html">dynamic_type</a></li><li><a href="/tips/linear-algebra.html">linear-algebra</a></li><li><a href="/tips/dynamic_bitset.html">dynamic_bitset</a></li><li><a href="/tips/timer.html">timer</a></li><li><a href="/tips/named_parameter.html">named_parameter</a></li><li><a href="/tips/io_state.html">io_state</a></li><li><a href="/tips/scope_guard.html">scope_guard</a></li><li><a href="/tips/interval_arithmetic.html">interval_arithmetic</a></li><li><a href="/tips/date_time.html">date_time</a></li><li><a href="/tips/lockfree-stack.html">lockfree-stack</a></li><li><a href="/tips/program_options.html">program_options</a></li><li><a href="/tips/hashmap.html">hashmap</a></li><li><a href="/tips/multi_array.html">multi_array</a></li><li><a href="/tips/serialize.html">serialize</a></li><li><a href="/tips/list.html">list</a></li><li><a href="/tips/statistics.html">statistics</a></li><li><a href="/tips/memory_mapped_file.html">memory_mapped_file</a></li><li><a href="/tips/priority_sort.html">priority_sort</a></li><li><a href="/tips/static_assert.html">static_assert</a></li><li><a href="/tips/constcond_overload.html">constcond_overload</a></li><li><a href="/tips/uuid.html">uuid</a></li><li><a href="/tips/lambda.html">lambda</a></li><li><a href="/tips/network.html">network</a></li><li><a href="/tips/random.html">random</a></li><li><a href="/tips/parser.html">parser</a></li><li><a href="/tips/graph.html">graph</a></li><li><a href="/tips/array.html">array</a></li><li><a href="/tips/build_link.html">build_link</a></li><li><a href="/tips/thread.html">thread</a></li><li><a href="/tips/optional.html">optional</a></li><li><a href="/tips/static_regex.html">static_regex</a></li><li><a href="/tips/unit_test.html">unit_test</a></li><li><a href="/tips/operators.html">operators</a></li><li><a href="/tips/noncopyable_container.html">noncopyable_container</a></li><li><a href="/tips/cxx11-boost-mapping.html">cxx11-boost-mapping</a></li><li><a href="/tips/foreach.html">foreach</a></li><li><a href="/tips/config.html">config</a></li><li><a href="/tips/iterator.html">iterator</a></li><li><a href="/tips/build.html">build</a></li><li><a href="/tips/dynamic_regex.html">dynamic_regex</a></li><li><a href="/tips/json.html">json</a></li><li><a href="/tips/smart_ptr.html">smart_ptr</a></li><li><a href="/tips/xml.html">xml</a></li><li><a href="/tips/circular_buffer.html">circular_buffer</a></li><li><a href="/tips/type_traits.html">type_traits</a></li><li><a href="/tips/function.html">function</a></li><li><a href="/tips/template_page.html">template_page</a></li><li><a href="/tips/variant.html">variant</a></li><li><a href="/tips/multiprec-float.html">multiprec-float</a></li><li><a href="/editors_doc/start_editing.html">start_editing</a></li><li><a href="/boostcon/2011.html">2011</a></li><li><a href="/boostcon/2010.html">2010</a></li><li><a href="/archive/propose.html">propose</a></li><li><a href="/archive/boost_docs.html">boost_docs</a></li><li><a href="/archive/cpp_online_reading.html">cpp_online_reading</a></li><li><a href="/cppnow/2014.html">2014</a></li><li><a href="/cppnow/2012.html">2012</a></li><li><a href="/cppnow/2013.html">2013</a></li><li><a href="/document/version.html">version</a></li><li><a href="/document/boostserialization.html">boostserialization</a></li><li><a href="/document/boost-range-algorithm-kansu-no-susume.html">boost-range-algorithm-kansu-no-susume</a></li><li><a href="/study_meeting/study5.html">study5</a></li><li><a href="/study_meeting/study6.html">study6</a></li><li><a href="/study_meeting/year-end-party2010-sapporo.html">year-end-party2010-sapporo</a></li><li><a href="/study_meeting/idea.html">idea</a></li><li><a href="/study_meeting/study14.html">study14</a></li><li><a href="/study_meeting/study13.html">study13</a></li><li><a href="/study_meeting/study10.html">study10</a></li><li><a href="/study_meeting/study4.html">study4</a></li><li><a href="/study_meeting/study16.html">study16</a></li><li><a href="/study_meeting/study8.html">study8</a></li><li><a href="/study_meeting/study11.html">study11</a></li><li><a href="/study_meeting/year-end-party2010-tokyo.html">year-end-party2010-tokyo</a></li><li><a href="/study_meeting/study12.html">study12</a></li><li><a href="/study_meeting/study9.html">study9</a></li><li><a href="/study_meeting/reversed_index.html">reversed_index</a></li><li><a href="/study_meeting/study7.html">study7</a></li><li><a href="/study_meeting/study1.html">study1</a></li><li><a href="/study_meeting/study3.html">study3</a></li><li><a href="/study_meeting/study15.html">study15</a></li><li><a href="/study_meeting/study2.html">study2</a></li><li><a href="/study_meeting/year-end-party2010-nagoya.html">year-end-party2010-nagoya</a></li></ul>
  </div>
  <div class="col-md-10">
<h1>Header boost/cast.hpp</h1>
<p>ヘッダboost/cast.hppは、C++の組み込みキャストを補完するべく作成された、 <a href="http://boostjp.github.io/archive/boost_docs/libs/conversion/cast.html#polymorphic_cast"><code><span style="color: #000">polymorphic_cast</span></code></a>, <a href="http://boostjp.github.io/archive/boost_docs/libs/conversion/cast.html#polymorphic_cast"><code><span style="color: #000">polymorphic_downcast</span></code></a>, <a href="http://boostjp.github.io/archive/boost_docs/libs/conversion/cast.html#numeric_cast"><code><span style="color: #000">numeric_cast</span></code></a>を提供する。</p>
<p>プログラムcast_test.cppは、これらの関数が期待通り動作するか確認するためのものである。</p>
<h2><a href="http://boostjp.github.io/archive/boost_docs/libs/conversion/polymorphic_cast" name="polymorphic_cast">多態キャスト</a></h2>
<p>多態オブジェクト(少なくとも一個の仮想関数を定義しているクラスのオブジェクト)へのポインタは、時にダウンキャストやクロスキャストされることがある。ダウンキャストとは基本クラスから派生クラスへのキャストである。クロスキャストは継承階層を横切るようなキャストである。例えば、多重継承した基本クラスの一つから、他の基本クラスへのキャストなど。</p>
<p>このようなキャストは古いキャスト演算子でも可能であるが、もうこのアプローチは推奨されない。古いキャスト演算子は型安全性に著しく欠け、可読性を激しく損ない、おまけに検索するのが大変なので。</p>
<p>C++に組み込まれた<code><span style="color: #000">static_cast</span></code>は、多態オブジェクトへのポインタを効率よくダウンキャストするが、ポインタが実際に指しているのと異なる派生クラスへのキャストをしようとしたとき、エラーを検出しない。 <code><span style="color: #000">polymorphic_downcast</span></code>テンプレートは、非デバッグコンパイル時には、<code><span style="color: #000">static_cast</span></code>の効率を維持するが、デバッグコンパイル時には、<code><span style="color: #000">dynamic_cast</span></code>の成功を<code><span style="color: #000">assert()</span></code>によって保証し、安全性を高める。</p>
<p>C++に組み込まれた<code><span style="color: #000">dynamic_cast</span></code>は、多態オブジェクトへのポインタをダウンキャストまたはクロスキャストするために使うことができるが、エラーを知るには不便にも、返却値が<code><span style="color: #000">0</span></code>でないかチェックしなければならず、さらに悪いことに、チェックしないでも済ますことができる。 <code><span style="color: #000">polymorphic_cast</span></code>テンプレートは<code><span style="color: #000">dynamic_cast</span></code>を行い、返却値が<code><span style="color: #000">0</span></code>だったときには例外を送出する。</p>
<p><code><span style="color: #000">polymorphic_downcast</span></code>は、デバッグモードでのテストで、キャストされうるオブジェクト型を100%カバーでき、同時に非デバッグモードでは効率が重要な場合に役立つであろう。 この二つの条件が満たされないなら、<code><span style="color: #000">polymorphic_cast</span></code>が適している。また、クロスキャストにはこちらを使わなければならない。 <code><span style="color: #000">polymorphic_downcast</span></code>は、<code><span style="color: #000">assert( dynamic_cast&lt;Derived&gt;(x) == x )</span></code> (<code><span style="color: #000">x</span></code>は基本クラスへのポインタ)を行う。<code><span style="color: #000">0</span></code>が返されなかったばかりでなく、多重継承したオブジェクトへのポインタも正しく変換されたことを保証するためである。 注意:: <code><span style="color: #000">polymorphic_downcast</span></code>は<code><span style="color: #000">assert()</span></code>を使っているので、<code><span style="color: #000">NDEBUG</span></code>の定義が翻訳単位間で異なっていると、単一定義規則(ODR)に違反する。[See ISO Std 3.2]</p>
<p>C++に組み込まれた<code><span style="color: #000">dynamic_cast</span></code>は、ポインタではなく参照のキャストに使われるべきである。さもなくば、あるインタフェースがサポートされているかどうか調べるために使うことができる。この場合、返却値が<code><span style="color: #000">0</span></code>になることはエラーではない。</p>
<h3><code><span style="color: #000">polymorphic_cast</span></code>と<code><span style="color: #000">polymorphic_downcast</span></code>の概要</h3>
<p><pre class="codehilite"><code class="language-cpp"><span style="color: #000">namespace boost {

template &lt;class Derived, class Base&gt;
inline Derived polymorphic_cast(Base* x);

// Throws: dynamic_cast&lt;Derived&gt;(x) == 0のときstd::bad_castを送出する
// Returns: dynamic_cast&lt;Derived&gt;(x)

template &lt;class Derived, class Base&gt;
inline Derived polymorphic_downcast(Base* x);
// Effects: assert( dynamic_cast&lt;Derived&gt;(x) == x );
// Returns: static_cast&lt;Derived&gt;(x)

}</span></code></pre>
</p>
<h3><code><span style="color: #000">polymorphic_downcast</span></code>の例</h3>
<p><pre class="codehilite"><code class="language-cpp"><span style="color: #000">#include &lt;boost/cast.hpp&gt;
...
class Fruit { public: virtual ~Fruit(){}; ... };
class Banana : public Fruit { ... };
...
void f( Fruit * fruit ) {
// ... logic which leads us to believe it is a Banana
  Banana * banana = boost::polymorphic_downcast&lt;Banana*&gt;(fruit);
  ...</span></code></pre>
</p>
<h2><a href="http://boostjp.github.io/archive/boost_docs/libs/conversion/numeric_cast" name="numeric_cast"><code><span style="color: #000">numeric_cast</span></code></a></h2>
<p><code><span style="color: #000">static_cast</span></code>や暗黙の変換は、数値をキャストしたときに、表現できる範囲を越えてしまっても感知しない。<code><span style="color: #000">numeric_cast</span></code>関数テンプレートは<code><span style="color: #000">static_cast</span></code>(や暗黙の変換にも、まあ、そこそこ)に似ているが、値の範囲を越えた場合、検出できる点が異なる。実行時に、値が正しく保存されるかチェックして、失敗した場合、例外が送出される。</p>
<p>引数型と返却値型の必須事項は次の通り:
- 引数型と返却値型は、いずれも<code><span style="color: #000">CopyConstructible</span></code> [ISO Std 20.1.3]でなければならない。
- 引数型と返却値型は、いずれも(<code><span style="color: #000">std::numeric_limits&lt;&gt;::is_specialized</span></code>が真であることで定義される)<code><span style="color: #000">Numeric</span></code>でなければならない。
- 引数型は、返却値型に<code><span style="color: #000">static_cast</span></code>を用いて変換できなければならない。</p>
<h3><code><span style="color: #000">numeric_cast</span></code>の概要</h3>
<p><pre class="codehilite"><code class="language-cpp"><span style="color: #000">namespace boost {

class bad_numeric_cast : public std::bad_cast {...};

template&lt;typename Target, typename Source&gt;
  inline Target numeric_cast(Source arg);

    // Throws:  SourceからTagertへの変換によって、std::numeric_limitsの定めに
    //          従い、負数の符号が無くなったり、アンダーフローやオーバーフロー
    //          する場合、bad_numeric_castを送出する。
    // Returns: static_cast&lt;Target&gt;(arg)

}</span></code></pre>
</p>
<h3><code><span style="color: #000">numeric_cast</span></code>の例</h3>
<p><pre class="codehilite"><code class="language-cpp"><span style="color: #000">#include &lt;boost/cast.hpp&gt;
using namespace boost::cast;

void ariane(double vx)
{
    ...
    unsigned short dx = numeric_cast&lt;unsigned short&gt;(vx);
    ...
}</span></code></pre>
</p>
<h3><code><span style="color: #000">numeric_cast</span></code>の理論的根拠</h3>
<p>例外送出の条件は、<code><span style="color: #000">!=</span></code> 演算の必要を無くすように構成されている。</p>
<h2>歴史的経緯</h2>
<p><code><span style="color: #000">polymorphic_cast</span></code>は"The C++ Programming Language"においてBjarne Stroustrupより提案された。</p>
<p><code><span style="color: #000">polymorphic_downcast</span></code>は<a href="http://www.boost.org/doc/libs/1_31_0/people/dave_abrahams.htm" target="_blank">Dave Abrahams</a>より寄贈された。</p>
<p><code><span style="color: #000">numeric_cast</span></code>は<a href="http://www.boost.org/doc/libs/1_31_0/people/kevlin_henney.htm" target="_blank">Kevlin Henney</a>より寄贈された。</p>
<hr />
<p>Revised 06 January, 2001</p>
<p>© Copyright boost.org 1999. Permission to copy, use, modify, sell and distribute this document is granted provided this copyright notice appears in all copies. This document is provided "as is" without express or implied warranty, and with no claim as to its suitability for any purpose.</p>
<hr />
<p>Japanese Translation Copyright (C) 2003 Yoshinori Tagawa.</p>
<p>オリジナルの、及びこの著作権表示が全ての複製の中に現れる限り、この文書の 複製、利用、変更、販売そして配布を認める。このドキュメントは「あるがまま」 に提供されており、いかなる明示的、暗黙的保証も行わない。また、 いかなる目的に対しても、その利用が適していることを関知しない。</p>
  </div>
</div>
            </div>
        </main>
    </body>
    <!-- Prompt IE 6 users to install Chrome Frame. Remove this if you want to support IE 6.  chromium.org/developers/how-tos/chrome-frame-getting-started -->
    <!--[if lt IE 7 ]>
        <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
        <script>
            window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})
        </script>
    <![endif]-->
</html>
